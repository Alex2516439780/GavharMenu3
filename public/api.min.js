class GavharAPI{constructor(){this.baseUrl=window.location.origin,this.endpoints={categories:"/api/categories",dishes:"/api/dishes",settings:"/api/settings"}}async request(e,t={}){const s=`${this.baseUrl}${e}`,r={headers:{"Content-Type":"application/json",...t.headers},...t};try{const e=await fetch(s,r);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return await e.json()}catch(s){return this.fallbackToLocalStorage(e,t)}}fallbackToLocalStorage(e,t){const s=t.method||"GET";return e.includes("/categories")?this.handleCategoriesLocal(s,t.body):e.includes("/dishes")?this.handleDishesLocal(s,t.body):e.includes("/settings")?this.handleSettingsLocal(s,t.body):{error:"Endpoint not found"}}async getCategories(){return this.request(this.endpoints.categories)}async createCategory(e){return this.request(this.endpoints.categories,{method:"POST",body:JSON.stringify(e)})}async updateCategory(e,t){return this.request(`${this.endpoints.categories}/${e}`,{method:"PUT",body:JSON.stringify(t)})}async deleteCategory(e){return this.request(`${this.endpoints.categories}/${e}`,{method:"DELETE"})}async getDishes(e={}){const t=new URLSearchParams(e).toString(),s=t?`${this.endpoints.dishes}?${t}`:this.endpoints.dishes;return this.request(s)}async getDishesByCategory(e){return this.getDishes({category:e})}async getDishesBySubcategory(e,t){return this.getDishes({category:e,subcategory:t})}async getDish(e){return this.request(`${this.endpoints.dishes}/${e}`)}async createDish(e){return this.request(this.endpoints.dishes,{method:"POST",body:JSON.stringify(e)})}async updateDish(e,t){return this.request(`${this.endpoints.dishes}/${e}`,{method:"PUT",body:JSON.stringify(t)})}async deleteDish(e){return this.request(`${this.endpoints.dishes}/${e}`,{method:"DELETE"})}async toggleDishStatus(e){return this.request(`${this.endpoints.dishes}/${e}/toggle-status`,{method:"PATCH"})}async getSettings(){return this.request(this.endpoints.settings)}async updateSettings(e){return this.request(this.endpoints.settings,{method:"PUT",body:JSON.stringify(e)})}handleCategoriesLocal(e,t){const s=JSON.parse(localStorage.getItem("gavhar_categories")||"[]");switch(e){case"GET":return{data:s,success:!0};case"POST":const e=JSON.parse(t);return e.id=Date.now(),s.push(e),localStorage.setItem("gavhar_categories",JSON.stringify(s)),{data:e,success:!0};case"PUT":case"DELETE":return{success:!0};default:return{error:"Method not supported"}}}handleDishesLocal(e,t){const s=JSON.parse(localStorage.getItem("gavhar_dishes")||"[]");switch(e){case"GET":return{data:s,success:!0};case"POST":const e=JSON.parse(t);return e.id=Date.now(),s.push(e),localStorage.setItem("gavhar_dishes",JSON.stringify(s)),{data:e,success:!0};case"PUT":case"DELETE":return{success:!0};default:return{error:"Method not supported"}}}handleSettingsLocal(e,t){switch(e){case"GET":return{data:{serviceCharge:parseInt(localStorage.getItem("gavhar_service_charge")||"10"),restaurantMode:localStorage.getItem("gavhar_restaurant_mode")||"public"},success:!0};case"PUT":const e=JSON.parse(t);return localStorage.setItem("gavhar_service_charge",e.serviceCharge.toString()),localStorage.setItem("gavhar_restaurant_mode",e.restaurantMode),{data:e,success:!0};default:return{error:"Method not supported"}}}async searchDishes(e){const t=await this.getDishes();if(!t.data)return{data:[],success:!0};return{data:t.data.filter(t=>{const s=e.toLowerCase();return t.name.ru.toLowerCase().includes(s)||t.name.uz.toLowerCase().includes(s)||t.name.en.toLowerCase().includes(s)||t.composition.ru.toLowerCase().includes(s)||t.composition.uz.toLowerCase().includes(s)||t.composition.en.toLowerCase().includes(s)}),success:!0}}isAlcoholicAllowed(){const e=new URLSearchParams(window.location.search);return e.has("restaurant")||e.has("admin")}getServiceChargePercent(){return new URLSearchParams(window.location.search).has("restaurant")?parseInt(localStorage.getItem("gavhar_service_charge")||"10"):0}async getFilteredMenu(){const[e,t]=await Promise.all([this.getCategories(),this.getDishes()]);if(!e.success||!t.success)throw new Error("Failed to load menu data");const s=this.isAlcoholicAllowed();return{categories:e.data.filter(e=>!e.isAlcoholic||s),dishes:t.data.filter(e=>e.inStock&&(!e.isAlcoholic||s)),serviceCharge:this.getServiceChargePercent()}}}window.gavharAPI=new GavharAPI,"undefined"!=typeof module&&module.exports&&(module.exports=GavharAPI);